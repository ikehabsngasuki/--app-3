name: render-keepalive

on:
  schedule:
    # JST 16:00-21:59 = UTC 07:00-12:59（月〜土）を10分おき
    - cron: "*/10 7-12 * * 1-6"
    # JST 22:00ちょうど = UTC 13:00（月〜土）を1回
    - cron: "0 13 * * 1-6"
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Render health endpoint (retry on failure)
        run: |
          set -euo pipefail
          URL="https://app-3-p9vd.onrender.com/healthz"

          if curl -fsS --max-time 20 --retry 2 --retry-delay 10 --retry-connrefused "$URL" > /dev/null; then
            echo "OK"
            exit 0
          fi

          echo "curl retry failed; final retry in 30s..."
          sleep 30
          curl -fsS --max-time 20 "$URL" > /dev/null
          echo "OK (final retry)"
