 {% extends "base.html" %}
{% block title %}問題作成 | 英単語テストPDF{% endblock %}
{% block content %}

<div class="card" style="display:grid; gap:16px;">
  <h2>問題作成</h2>
  <p class="label-desc">
    アップロード済みの Excel を選び、番号の範囲と出題数を指定して PDF を生成します。
    ヘッダーは <strong>number / word / meaning</strong> が必要です（順不同でOK）。
  </p>

  {# ラジオの選択状態を保持 #}
  {% set selected_mode = request.form.get('mode', 'en-ja') %}

  <form action="{{ url_for('make') }}" method="post" class="stack">
    <div class="field">
      <label for="filename">ファイルを選択</label>
      <select id="filename" name="filename" class="input" required {% if not files %}disabled{% endif %}>
        {% for f in files %}
          <option value="{{ f }}">{{ f }}</option>
        {% endfor %}
      </select>
      {% if not files %}
        <p class="label-desc" style="margin-top:6px;">
          まだファイルがありません。先に
          <a href="{{ url_for('upload') }}">アップロード</a> してください。
        </p>
      {% endif %}
    </div>

    <!-- 出題モード（独立した field に） -->
    <div class="field">
      <label>出題モード</label>
      <div>
        <label>
          <input type="radio" name="mode" value="en-ja"
                 {% if selected_mode == 'en-ja' %}checked{% endif %}>
          英 → 和（英和）
        </label>
        <label style="margin-left:12px;">
          <input type="radio" name="mode" value="ja-en"
                 {% if selected_mode == 'ja-en' %}checked{% endif %}>
          和 → 英（和英）
        </label>
      </div>
      <p class="label-desc" style="margin-top:6px;">
        英和：問題に <code>word</code>、解答に <code>meaning</code> を表示。<br>
        和英：問題に <code>meaning</code>、解答に <code>word</code> を表示。
      </p>
    </div>

    <div class="field">
      <label for="start_num">開始番号</label>
      <input id="start_num" class="input" type="number" name="start_num" min="1" placeholder="例: 1" required />
    </div>

    <div class="field">
      <label for="end_num">終了番号</label>
      <input id="end_num" class="input" type="number" name="end_num" min="1" placeholder="例: 100" required />
    </div>

    <div class="field">
      <label for="num_questions">出題数</label>
      <input id="num_questions" class="input" type="number" name="num_questions" min="1" placeholder="例: 20" required />
      <p class="label-desc" style="margin-top:6px;">
        指定範囲内からランダムに選ばれます（最大は範囲内の件数まで）。
      </p>
    </div>

    <div>
      <button type="submit" class="btn btn-primary" {% if not files %}disabled{% endif %}>PDFを作成</button>
      <a class="btn btn-outline" href="{{ url_for('download') }}" style="margin-left:6px;">ダウンロードへ</a>
    </div>
  </form>
</div>

{% endblock %}
